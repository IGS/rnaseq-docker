version: '2'
services:

  ergatis:
    environment:
      - DOCKER_HOST=###IP_HOST###
    image: adkinsrs/lgtseek:1.3
    links:
      - mongo
    mem_limit: 5120000000
    ports:
      - "8080:80"
    volumes:
      - ###DONOR_MNT###:/mnt/input_data/donor_ref:ro
      - ###RECIPIENT_MNT###:/mnt/input_data/recipient_ref:ro
      - ###REFSEQ_MNT###:/mnt/input_data/refseq_ref:ro
      - ###INPUT_MNT###:/mnt/input_data/input_source:ro
      - ###BLAST_DB_DIR###:/mnt/blast:ro
      - ###OUTPUT_DATA###:/mnt/output_data
    volumes_from:
      - mongodata

  mongo:
    image: mongo:3.0.4
    volumes_from:
      - mongodata
    ports:
      - "27017:27017"
    command: --smallfiles --rest

# Mongodata is necessary for persistent data storage
# MongoDB normally wipes data when shut down
  mongodata:
    image: mongo:3.0.4
    volumes:
      - /data/db
    command: --break-mongo
